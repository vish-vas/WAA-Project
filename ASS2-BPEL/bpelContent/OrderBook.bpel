<!-- OrderBook BPEL Process [Generated by the Eclipse BPEL Designer] -->
<!-- Date: Mon Mar 05 14:52:21 IST 2012 -->
<bpel:process name="OrderBook"
         targetNamespace="http://waa.swin.edu.au"
         suppressJoinFailure="yes"
         xmlns:tns="http://waa.swin.edu.au"
         xmlns:bpel="http://docs.oasis-open.org/wsbpel/2.0/process/executable"
         xmlns:ns="http://student.waa.swin.edu.au" xmlns:ns0="http://book.waa.swin.edu.au" xmlns:ns1="http://google.waa.swin.edu.au" xmlns:ns2="http://evaluate.waa.swin.edu.au">

    <!-- ================================================================= -->         
    <!-- ORCHESTRATION LOGIC                                               -->
    <!-- Set of activities coordinating the flow of messages across the    -->
    <!-- services integrated within this business process                  -->
    <!-- ================================================================= -->         
    <bpel:import namespace="http://waa.swin.edu.au" location="OrderBookArtifacts.wsdl" importType="http://schemas.xmlsoap.org/wsdl/"></bpel:import>
    <bpel:partnerLinks>
        <bpel:partnerLink name="clientPartnerLink" partnerLinkType="tns:OrderBookPLT" myRole="orderBookProcess"></bpel:partnerLink>
        <bpel:partnerLink name="studentPartnerLink" partnerLinkType="tns:StudentPLT" partnerRole="studentValidationProcess"></bpel:partnerLink>
        <bpel:partnerLink name="internalBookPartnerLink" partnerLinkType="tns:BookServicePLT" partnerRole="intrenalBookProcess"></bpel:partnerLink>
        <bpel:partnerLink name="googlePartnerLink" partnerLinkType="tns:GoogleServicePLT" partnerRole="getBookProcess"></bpel:partnerLink>
        <bpel:partnerLink name="evaluationPartnerLink" partnerLinkType="tns:EvaluationPLT" partnerRole="evaluationProcess"></bpel:partnerLink>
    </bpel:partnerLinks>
    <bpel:variables>
        <bpel:variable name="clientPartnerLinkRequest" messageType="tns:orderBookRequest"></bpel:variable>
        <bpel:variable name="studentPartnerLinkResponse" messageType="ns:authenticateStudentResponse"></bpel:variable>
        <bpel:variable name="studentPartnerLinkRequest" messageType="ns:authenticateStudentRequest"></bpel:variable>
        <bpel:variable name="internalBookPartnerLinkResponse" messageType="ns0:validateBookInLibraryResponse"></bpel:variable>
        <bpel:variable name="internalBookPartnerLinkRequest" messageType="ns0:validateBookInLibraryRequest"></bpel:variable>
        <bpel:variable name="clientPartnerLinkResponse" messageType="tns:orderBookResponse"></bpel:variable>
        <bpel:variable name="googlePartnerLinkResponse" messageType="ns1:GetBookInformationResponse"></bpel:variable>
        <bpel:variable name="googlePartnerLinkRequest" messageType="ns1:GetBookInformationRequest"></bpel:variable>
        <bpel:variable name="evaluationPartnerLinkResponse" messageType="ns2:evaluateGoogleResponseResponse"></bpel:variable>
        <bpel:variable name="evaluationPartnerLinkRequest" messageType="ns2:evaluateGoogleResponseRequest"></bpel:variable>
        <bpel:variable name="internalBookPartnerLinkResponse1" messageType="ns0:addNewBookResponse"></bpel:variable>
        <bpel:variable name="internalBookPartnerLinkRequest1" messageType="ns0:addNewBookRequest"></bpel:variable>
    </bpel:variables>
    <bpel:sequence name="main">
		
        <bpel:receive name="ReceiveInputs" partnerLink="clientPartnerLink" operation="orderBook" portType="tns:OrderBookPortType" variable="clientPartnerLinkRequest" createInstance="yes"></bpel:receive>
        <bpel:assign validate="no" name="AssignInputsToValidateStudent">
            <bpel:copy>
                <bpel:from><bpel:literal><ns:authenticateStudent xmlns:ns="http://student.waa.swin.edu.au" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <ns:enteredId>ns:enteredId</ns:enteredId>
  <ns:enteredPin>ns:enteredPin</ns:enteredPin>
</ns:authenticateStudent>
</bpel:literal></bpel:from>
                <bpel:to variable="studentPartnerLinkRequest" part="parameters"></bpel:to>
            </bpel:copy>
            <bpel:copy>
                <bpel:from part="parameters" variable="clientPartnerLinkRequest">
                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[studentID]]></bpel:query>
                </bpel:from>
                <bpel:to part="parameters" variable="studentPartnerLinkRequest">
                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[ns:enteredId]]></bpel:query>
                </bpel:to>
            </bpel:copy>
            <bpel:copy>
                <bpel:from part="parameters" variable="clientPartnerLinkRequest">
                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[studentPin]]></bpel:query>
                </bpel:from>
                <bpel:to part="parameters" variable="studentPartnerLinkRequest">
                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[ns:enteredPin]]></bpel:query>
                </bpel:to>
            </bpel:copy>
        </bpel:assign>
        <bpel:if name="IfStudentIsValid">
            <bpel:condition expressionLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[$studentPartnerLinkResponse.parameters/ns:return="Authenticated"]]></bpel:condition>
            <bpel:sequence>
                <bpel:assign validate="no" name="AssignInputsForLibraryBookValidation">
                    <bpel:copy>
                        <bpel:from><bpel:literal><ns:validateBookInLibrary xmlns:ns="http://book.waa.swin.edu.au" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <ns:bookIsbn>ns:bookIsbn</ns:bookIsbn>
</ns:validateBookInLibrary>
</bpel:literal></bpel:from>
                        <bpel:to variable="internalBookPartnerLinkRequest" part="parameters"></bpel:to>
                    </bpel:copy>
                    <bpel:copy>
                        <bpel:from part="parameters" variable="clientPartnerLinkRequest">
                            <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[bookISBN]]></bpel:query>
                        </bpel:from>
                        <bpel:to part="parameters" variable="internalBookPartnerLinkRequest">
                            <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[ns0:bookIsbn]]></bpel:query>
                        </bpel:to>
                    </bpel:copy>
                </bpel:assign>
                <bpel:invoke name="InvokeInternalBookValidationService" partnerLink="internalBookPartnerLink" operation="validateBookInLibrary" portType="ns0:BookServicePortType" inputVariable="internalBookPartnerLinkRequest" outputVariable="internalBookPartnerLinkResponse"></bpel:invoke>
                <bpel:if name="IfBookNotFound">
                    <bpel:condition expressionLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[$internalBookPartnerLinkResponse.parameters/ns0:return="true"]]></bpel:condition>
                    <bpel:sequence>
                        <bpel:assign validate="no" name="AssignInputsForGoogleBookRetrival">
                            <bpel:copy>
                                <bpel:from><bpel:literal><ns:GetBookInformation xmlns:ns="http://google.waa.swin.edu.au" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <isbn>isbn</isbn>
</ns:GetBookInformation>
</bpel:literal></bpel:from>
                                <bpel:to variable="googlePartnerLinkRequest" part="parameters"></bpel:to>
                            </bpel:copy>
                            <bpel:copy>
                                <bpel:from part="parameters" variable="clientPartnerLinkRequest">
                                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[bookISBN]]></bpel:query>
                                </bpel:from>
                                <bpel:to part="parameters" variable="googlePartnerLinkRequest">
                                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[isbn]]></bpel:query>
                                </bpel:to>
                            </bpel:copy>
                        </bpel:assign>
                        <bpel:invoke name="InvokeGoogleBookService" partnerLink="googlePartnerLink" operation="GetBookInformation" portType="ns1:GoogleBookProxyServicePortType" inputVariable="googlePartnerLinkRequest" outputVariable="googlePartnerLinkResponse"></bpel:invoke>
                        <bpel:if name="IfIsbnIsValid">
                            <bpel:condition expressionLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[$googlePartnerLinkResponse.parameters/isValidISBN="true"]]></bpel:condition>
                            <bpel:sequence>
                                <bpel:assign validate="no" name="AssignInputsForGoogleResponseEvaluation">
                                    <bpel:copy>
                                        <bpel:from><bpel:literal><ns:evaluateGoogleResponse xmlns:ns="http://evaluate.waa.swin.edu.au" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <ns:rating>ns:rating</ns:rating>
  <ns:availability>ns:availability</ns:availability>
</ns:evaluateGoogleResponse>
</bpel:literal></bpel:from>
                                        <bpel:to variable="evaluationPartnerLinkRequest" part="parameters"></bpel:to>
                                    </bpel:copy>
                                    <bpel:copy>
                                        <bpel:from part="parameters" variable="googlePartnerLinkResponse">
                                            <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[averageRating]]></bpel:query>
                                        </bpel:from>
                                        <bpel:to part="parameters" variable="evaluationPartnerLinkRequest">
                                            <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[ns2:rating]]></bpel:query>
                                        </bpel:to>
                                    </bpel:copy>
                                    <bpel:copy>
                                        <bpel:from part="parameters" variable="googlePartnerLinkResponse">
                                            <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[availability]]></bpel:query>
                                        </bpel:from>
                                        <bpel:to part="parameters" variable="evaluationPartnerLinkRequest">
                                            <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[ns2:availability]]></bpel:query>
                                        </bpel:to>
                                    </bpel:copy>
                                </bpel:assign>
                                <bpel:invoke name="InvokeGoogleResponseEvaluationService" partnerLink="evaluationPartnerLink" operation="evaluateGoogleResponse" portType="ns2:EvaluateResponsePortType" inputVariable="evaluationPartnerLinkRequest" outputVariable="evaluationPartnerLinkResponse"></bpel:invoke>
                                <bpel:if name="IfEvaluationSuccessful">
                                    <bpel:condition expressionLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[$evaluationPartnerLinkResponse.parameters/ns2:return="true"]]></bpel:condition>
                                    <bpel:sequence>
                                        <bpel:assign validate="no" name="AssignInputsToOrderBook">
                                            <bpel:copy>
                                                <bpel:from><bpel:literal><ns:addNewBook xmlns:ns="http://book.waa.swin.edu.au" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <ns:bookID>ns:bookID</ns:bookID>
  <ns:bookTitle>ns:bookTitle</ns:bookTitle>
  <ns:bookAuthors>ns:bookAuthors</ns:bookAuthors>
  <ns:bookIsbn>ns:bookIsbn</ns:bookIsbn>
  <ns:bookIsbn13>ns:bookIsbn13</ns:bookIsbn13>
  <ns:bookPublisher>ns:bookPublisher</ns:bookPublisher>
  <ns:bookPublishDate>ns:bookPublishDate</ns:bookPublishDate>
  <ns:bookStatus>ns:bookStatus</ns:bookStatus>
</ns:addNewBook>
</bpel:literal></bpel:from>
                                                <bpel:to variable="internalBookPartnerLinkRequest1" part="parameters"></bpel:to>
                                            </bpel:copy>
                                            <bpel:copy>
                                                <bpel:from part="parameters" variable="googlePartnerLinkResponse">
                                                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[bookID]]></bpel:query>
                                                </bpel:from>
                                                <bpel:to part="parameters" variable="internalBookPartnerLinkRequest1">
                                                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[ns0:bookID]]></bpel:query>
                                                </bpel:to>
                                            </bpel:copy>
                                            <bpel:copy>
                                                <bpel:from part="parameters" variable="googlePartnerLinkResponse">
                                                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[title]]></bpel:query>
                                                </bpel:from>
                                                <bpel:to part="parameters" variable="internalBookPartnerLinkRequest1">
                                                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[ns0:bookTitle]]></bpel:query>
                                                </bpel:to>
                                            </bpel:copy>
                                            <bpel:copy>
                                                <bpel:from part="parameters" variable="googlePartnerLinkResponse">
                                                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[authors]]></bpel:query>
                                                </bpel:from>
                                                <bpel:to part="parameters" variable="internalBookPartnerLinkRequest1">
                                                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[ns0:bookAuthors]]></bpel:query>
                                                </bpel:to>
                                            </bpel:copy>
                                            <bpel:copy>
                                                <bpel:from part="parameters" variable="googlePartnerLinkResponse">
                                                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[isbn]]></bpel:query>
                                                </bpel:from>
                                                <bpel:to part="parameters" variable="internalBookPartnerLinkRequest1">
                                                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[ns0:bookIsbn]]></bpel:query>
                                                </bpel:to>
                                            </bpel:copy>
                                            <bpel:copy>
                                                <bpel:from part="parameters" variable="googlePartnerLinkResponse">
                                                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[isbn13]]></bpel:query>
                                                </bpel:from>
                                                <bpel:to part="parameters" variable="internalBookPartnerLinkRequest1">
                                                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[ns0:bookIsbn13]]></bpel:query>
                                                </bpel:to>
                                            </bpel:copy>
                                            <bpel:copy>
                                                <bpel:from part="parameters" variable="googlePartnerLinkResponse">
                                                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[publisher]]></bpel:query>
                                                </bpel:from>
                                                <bpel:to part="parameters" variable="internalBookPartnerLinkRequest1">
                                                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[ns0:bookPublisher]]></bpel:query>
                                                </bpel:to>
                                            </bpel:copy>
                                            <bpel:copy>
                                                <bpel:from part="parameters" variable="googlePartnerLinkResponse">
                                                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[publishedDate]]></bpel:query>
                                                </bpel:from>
                                                <bpel:to part="parameters" variable="internalBookPartnerLinkRequest1">
                                                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[ns0:bookPublishDate]]></bpel:query>
                                                </bpel:to>
                                            </bpel:copy>
                                            <bpel:copy>
                                                <bpel:from>
                                                    <bpel:literal>back order</bpel:literal>
                                                </bpel:from>
                                                <bpel:to part="parameters" variable="internalBookPartnerLinkRequest1">
                                                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[ns0:bookStatus]]></bpel:query>
                                                </bpel:to>
                                            </bpel:copy>
                                        </bpel:assign>
                                        <bpel:invoke name="InvokeAddBookService" partnerLink="internalBookPartnerLink" operation="addNewBook" portType="ns0:BookServicePortType" inputVariable="internalBookPartnerLinkRequest1" outputVariable="internalBookPartnerLinkResponse1"></bpel:invoke>
                                        <bpel:assign validate="no" name="AssignResponseToOutput">
                                            <bpel:copy>
                                                <bpel:from><bpel:literal><ns:orderBookResponse xmlns:ns="http://waa.swin.edu.au" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <status>status</status>
  <response>response</response>
</ns:orderBookResponse>
</bpel:literal></bpel:from>
                                                <bpel:to variable="clientPartnerLinkResponse" part="parameters"></bpel:to>
                                            </bpel:copy>
                                            <bpel:copy>
                                                <bpel:from part="parameters" variable="internalBookPartnerLinkResponse1">
                                                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[ns0:return]]></bpel:query>
                                                </bpel:from>
                                                <bpel:to part="parameters" variable="clientPartnerLinkResponse">
                                                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[status]]></bpel:query>
                                                </bpel:to>
                                            </bpel:copy>
                                            <bpel:copy>
                                                <bpel:from>
                                                    <bpel:literal>Your book has been added to the system and will be ordered soon.</bpel:literal>
                                                </bpel:from>
                                                <bpel:to part="parameters" variable="clientPartnerLinkResponse">
                                                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[response]]></bpel:query>
                                                </bpel:to>
                                            </bpel:copy>
                                        </bpel:assign>
                                    </bpel:sequence>
                                    <bpel:else>
                                        <bpel:assign validate="no" name="AssignBookEvaluationFailedOutput">
                                            <bpel:copy>
                                                <bpel:from><bpel:literal><ns:orderBookResponse xmlns:ns="http://waa.swin.edu.au" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <status>status</status>
  <response>response</response>
</ns:orderBookResponse>
</bpel:literal></bpel:from>
                                                <bpel:to variable="clientPartnerLinkResponse" part="parameters"></bpel:to>
                                            </bpel:copy>
                                            <bpel:copy>
                                                <bpel:from part="parameters" variable="evaluationPartnerLinkResponse">
                                                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[ns2:return]]></bpel:query>
                                                </bpel:from>
                                                <bpel:to part="parameters" variable="clientPartnerLinkResponse">
                                                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[response]]></bpel:query>
                                                </bpel:to>
                                            </bpel:copy>
                                            <bpel:copy>
                                                <bpel:from>
                                                    <bpel:literal>evaluationFailure</bpel:literal>
                                                </bpel:from>
                                                <bpel:to part="parameters" variable="clientPartnerLinkResponse">
                                                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[status]]></bpel:query>
                                                </bpel:to>
                                            </bpel:copy>
                                        </bpel:assign>
                                    </bpel:else>
                                </bpel:if>
                            </bpel:sequence>
                            <bpel:else>
                                <bpel:assign validate="no" name="AssignInvalidISBNOutput">
                                    <bpel:copy>
                                        <bpel:from><bpel:literal><ns:orderBookResponse xmlns:ns="http://waa.swin.edu.au" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <status>status</status>
  <response>response</response>
</ns:orderBookResponse>
</bpel:literal></bpel:from>
                                        <bpel:to variable="clientPartnerLinkResponse" part="parameters"></bpel:to>
                                    </bpel:copy>
                                    <bpel:copy>
                                        <bpel:from part="parameters" variable="googlePartnerLinkResponse">
                                            <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[isValidISBN]]></bpel:query>
                                        </bpel:from>
                                        <bpel:to part="parameters" variable="clientPartnerLinkResponse">
                                            <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[status]]></bpel:query>
                                        </bpel:to>
                                    </bpel:copy>
                                    <bpel:copy>
                                        <bpel:from>
                                            <bpel:literal>The given ISBN was not found on Google Books Store.</bpel:literal>
                                        </bpel:from>
                                        <bpel:to part="parameters" variable="clientPartnerLinkResponse">
                                            <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[response]]></bpel:query>
                                        </bpel:to>
                                    </bpel:copy>
                                </bpel:assign>
                            </bpel:else>
                        </bpel:if>
                    </bpel:sequence>
                    <bpel:elseif>
                        <bpel:condition expressionLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[$internalBookPartnerLinkResponse.parameters/ns0:return="available"]]></bpel:condition>
                        <bpel:assign validate="no" name="AssignBookAvailableOutput">
                            <bpel:copy>
                                <bpel:from><bpel:literal><ns:orderBookResponse xmlns:ns="http://waa.swin.edu.au" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <status>status</status>
  <response>response</response>
</ns:orderBookResponse>
</bpel:literal></bpel:from>
                                <bpel:to variable="clientPartnerLinkResponse" part="parameters"></bpel:to>
                            </bpel:copy>
                            <bpel:copy>
                                <bpel:from part="parameters" variable="internalBookPartnerLinkResponse">
                                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[ns0:return]]></bpel:query>
                                </bpel:from>
                                <bpel:to part="parameters" variable="clientPartnerLinkResponse">
                                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[status]]></bpel:query>
                                </bpel:to>
                            </bpel:copy>
                            <bpel:copy>
                                <bpel:from>
                                    <bpel:literal>Book with given ISBN is already in Library System. and so can not be ordered!</bpel:literal>
                                </bpel:from>
                                <bpel:to part="parameters" variable="clientPartnerLinkResponse">
                                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[response]]></bpel:query>
                                </bpel:to>
                            </bpel:copy>
                        </bpel:assign>
                    </bpel:elseif><bpel:elseif>
                        <bpel:condition expressionLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[$internalBookPartnerLinkResponse.parameters/ns0:return="ordered"]]></bpel:condition>
                        <bpel:assign validate="no" name="AssignAlreadyOrderedOutput">
                            <bpel:copy>
                                <bpel:from><bpel:literal><ns:orderBookResponse xmlns:ns="http://waa.swin.edu.au" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <status>status</status>
  <response>response</response>
</ns:orderBookResponse>
</bpel:literal></bpel:from>
                                <bpel:to variable="clientPartnerLinkResponse" part="parameters"></bpel:to>
                            </bpel:copy>
                            <bpel:copy>
                                <bpel:from part="parameters" variable="internalBookPartnerLinkResponse">
                                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[ns0:return]]></bpel:query>
                                </bpel:from>
                                <bpel:to part="parameters" variable="clientPartnerLinkResponse">
                                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[status]]></bpel:query>
                                </bpel:to>
                            </bpel:copy>
                            <bpel:copy>
                                <bpel:from>
                                    <bpel:literal>The book with given ISBN is already been ordered. And so can not be ordered again.</bpel:literal>
                                </bpel:from>
                                <bpel:to part="parameters" variable="clientPartnerLinkResponse">
                                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[response]]></bpel:query>
                                </bpel:to>
                            </bpel:copy>
                        </bpel:assign>
                    </bpel:elseif></bpel:if>
            </bpel:sequence>
            <bpel:else>
                <bpel:assign validate="no" name="AssignStudentInvalidOutput">
                    <bpel:copy>
                        <bpel:from><bpel:literal><ns:orderBookResponse xmlns:ns="http://waa.swin.edu.au" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <status>status</status>
  <response>response</response>
</ns:orderBookResponse>
</bpel:literal></bpel:from>
                        <bpel:to variable="clientPartnerLinkResponse" part="parameters"></bpel:to>
                    </bpel:copy>
                    <bpel:copy>
                        <bpel:from part="parameters" variable="studentPartnerLinkResponse">
                            <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">
                                <![CDATA[ns:return]]>
                            </bpel:query>
                        </bpel:from>
                        <bpel:to part="parameters" variable="clientPartnerLinkResponse">
                            <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[status]]></bpel:query>
                        </bpel:to>
                    </bpel:copy>
                    <bpel:copy>
                        <bpel:from>
                            <bpel:literal>Student Authentication Failed!</bpel:literal>
                        </bpel:from>
                        <bpel:to part="parameters" variable="clientPartnerLinkResponse">
                            <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[response]]></bpel:query>
                        </bpel:to>
                    </bpel:copy>
                </bpel:assign>
            </bpel:else>
        </bpel:if>
        <bpel:reply name="ReplyOutputs" partnerLink="clientPartnerLink" operation="orderBook" portType="tns:OrderBookPortType" variable="clientPartnerLinkResponse"></bpel:reply>
    </bpel:sequence>    
</bpel:process>

